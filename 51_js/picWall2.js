/**
 * Created by bjwsl-001 on 2016/10/31.
 */
var DATA = {
    "big": [
        {"durl": "draw_yoo/big10.jpg", "dy": "dy152124"},
        {"durl": "draw_yoo/big2.jpg", "dy": "dy166275"},
        {"durl": "draw_yoo/big3.jpg", "dy": "dy157873"},
        {"durl": "draw_yoo/big4.jpg", "dy": "dy149867"},
        {"durl": "draw_yoo/big5.jpg", "dy": "dy154990"}, {
            "durl": "draw_yoo/big6.jpg",
            "dy": "dy164194"
        }, {"durl": "draw_yoo/big7.jpg", "dy": "dy152152"}, {
            "durl": "draw_yoo/big8.jpg",
            "dy": "dy151937"
        }, {"durl": "draw_yoo/big1.jpg", "dy": "dy163601"}, {
            "durl": "draw_yoo/big9.jpg",
            "dy": "dy151825"
        }],
    "small": [
        {"durl": "draw_yoo/w1.jpg", "dy": "dy149981"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy156676"
    }, {"durl": "draw_yoo/w6.jpg", "dy": "dy152140"}, {
        "durl": "draw_yoo/w5.jpg",
        "dy": "dy150653"
    }, {"durl": "draw_yoo/big10.jpg", "dy": "dy156126"}, {
        "durl": "draw_yoo/w4.jpg",
        "dy": "dy151703"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy151346"}, {
        "durl": "draw_yoo/big8.jpg",
        "dy": "dy157765"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy151209"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy149801"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy152234"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy156675"
    }, {"durl": "draw_yoo/big10.jpg", "dy": "dy151914"}, {
        "durl": "draw_yoo/w2.jpg",
        "dy": "dy150930"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy151921"}, {
        "durl": "draw_yoo/big7.jpg",
        "dy": "dy151677"
    }, {"durl": "draw_yoo/big6.jpg", "dy": "dy156171"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy151334"
    }, {"durl": "draw_yoo/w4.jpg", "dy": "dy149909"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy149991"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy150811"}, {
        "durl": "draw_yoo/big5.jpg",
        "dy": "dy150279"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy151409"}, {
        "durl": "draw_yoo/w5.jpg",
        "dy": "dy155296"
    }, {"durl": "draw_yoo/w6.jpg", "dy": "dy155249"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy151924"
    }, {"durl": "draw_yoo/w11.jpg", "dy": "dy151356"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy152176"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy156900"}, {
        "durl": "draw_yoo/big3.jpg",
        "dy": "dy151147"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy157886"}, {
        "durl": "draw_yoo/w4.jpg",
        "dy": "dy149847"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy157913"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy156897"
    }, {"durl": "draw_yoo/w7.jpg", "dy": "dy156291"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy152301"
    }, {"durl": "draw_yoo/w8.jpg", "dy": "dy151739"}, {
        "durl": "draw_yoo/big4.jpg",
        "dy": "dy157802"
    }, {"durl": "draw_yoo/big4.jpg", "dy": "dy151742"}, {
        "durl": "draw_yoo/w3.jpg",
        "dy": "dy150702"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy156292"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy156438"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy152293"}, {
        "durl": "draw_yoo/w6.jpg",
        "dy": "dy150092"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy150867"}, {
        "durl": "draw_yoo/w10.jpg",
        "dy": "dy154997"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy151287"}, {
        "durl": "draw_yoo/w2.jpg",
        "dy": "dy150545"
    }, {"durl": "draw_yoo/big7.jpg", "dy": "dy150881"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy157923"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy157930"}, {
        "durl": "draw_yoo/big4.jpg",
        "dy": "dy157766"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy156904"}, {
        "durl": "draw_yoo/yige_152.png",
        "dy": "dy156823"
    }, {"durl": "draw_yoo/yige_152.png", "dy": "dy149808"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy152177"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy150528"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy156388"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy150818"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy156846"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy150657"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy155603"
    }, {"durl": "draw_yoo/big9.jpg", "dy": "dy156296"}, {
        "durl": "draw_yoo/w2.jpg",
        "dy": "dy151131"
    }, {"durl": "draw_yoo/w3.jpg", "dy": "dy156936"}, {
        "durl": "draw_yoo/w10.jpg",
        "dy": "dy151743"
    }, {"durl": "draw_yoo/big10.jpg", "dy": "dy152299"}, {
        "durl": "draw_yoo/w4.jpg",
        "dy": "dy150919"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy151195"}, {
        "durl": "draw_yoo/big2.jpg",
        "dy": "dy150819"
    }, {"durl": "draw_yoo/w8.jpg", "dy": "dy152243"}, {
        "durl": "draw_yoo/big8.jpg",
        "dy": "dy157764"
    }, {"durl": "draw_yoo/w9.jpg", "dy": "dy156926"}, {
        "durl": "draw_yoo/w1.jpg",
        "dy": "dy150789"
    }, {"durl": "draw_yoo/t1.jpg", "dy": "dy151099"}, {
        "durl": "draw_yoo/big2.jpg",
        "dy": "dy157896"
    }, {"durl": "draw_yoo/w7.jpg", "dy": "dy156643"}, {
        "durl": "draw_yoo/w11.jpg",
        "dy": "dy151672"
    }, {"durl": "draw_yoo/w10.jpg", "dy": "dy152238"}, {
        "durl": "draw_yoo/big10.jpg",
        "dy": "dy156213"
    }, {"durl": "draw_yoo/big8.jpg", "dy": "dy150672"}, {
        "durl": "draw_yoo/w12.jpg",
        "dy": "dy156137"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy157922"}, {
        "durl": "draw_yoo/big8.jpg",
        "dy": "dy156673"
    }, {"durl": "draw_yoo/big9.jpg", "dy": "dy151871"}, {
        "durl": "draw_yoo/w2.jpg",
        "dy": "dy149855"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy152137"}, {
        "durl": "draw_yoo/big10.jpg",
        "dy": "dy156031"
    }, {"durl": "draw_yoo/w3.jpg", "dy": "dy151263"}, {
        "durl": "draw_yoo/big8.jpg",
        "dy": "dy150873"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy156089"}, {
        "durl": "draw_yoo/w4.jpg",
        "dy": "dy156390"
    }, {"durl": "draw_yoo/big3.jpg", "dy": "dy156827"}, {
        "durl": "draw_yoo/big6.jpg",
        "dy": "dy156478"
    }, {"durl": "draw_yoo/w1.jpg", "dy": "dy152129"}],
    "tag": [
        {"tag": "JK", "ref": "126", "key_word": "%E9%BB%91%E4%B8%9D"}, {
        "tag": "表情",
        "ref": "57",
        "key_word": "%E8%A1%A8%E6%83%85"
    }, {"tag": "双马尾", "ref": "378", "key_word": "%E5%8F%8C%E9%A9%AC%E5%B0%BE"}, {
        "tag": "云",
        "ref": "111",
        "key_word": "%E4%BA%91"
    }, {"tag": "Ｑ版", "ref": "54", "key_word": "%EF%BC%B1%E7%89%88"}, {
        "tag": "魔法",
        "ref": "51",
        "key_word": "%E9%AD%94%E6%B3%95"
    }, {"tag": "驱魔少年", "ref": "63", "key_word": "%E9%A9%B1%E9%AD%94%E5%B0%91%E5%B9%B4"}, {
        "tag": "万花",
        "ref": "87",
        "key_word": "%E4%B8%87%E8%8A%B1"
    }, {"tag": "鸟", "ref": "52", "key_word": "%E9%B8%9F"}, {
        "tag": "剑网三",
        "ref": "402",
        "key_word": "%E5%89%91%E7%BD%91%E4%B8%89"
    }, {"tag": "鹤丸国永", "ref": "66", "key_word": "%E9%B9%A4%E4%B8%B8%E5%9B%BD%E6%B0%B8"}, {
        "tag": "游戏",
        "ref": "192",
        "key_word": "%E6%B8%B8%E6%88%8F"
    }, {"tag": "魂魄妖梦", "ref": "117", "key_word": "%E9%AD%82%E9%AD%84%E5%A6%96%E6%A2%A6"}, {
        "tag": "鼠绘上色",
    }, {"tag": "缠流子", "ref": "51", "key_word": "%E7%BC%A0%E6%B5%81%E5%AD%90"}]

}
var picWall={
    MAX_COL:6,
    MAX_ROW:0,
    Xgap:2,
    Ygap:2,
    BWIDTH:150,
    BHEIGHT:150,
    ruleBig:3,
    ruleTag:2,
    data:[],//最初的资源列表
    warapper:$('.pic_scroll_warpper'),//容器DIV
    temp:{},//放内存里存图片属性
    grid:[],
    pageNum:0,
    colors: [  //随机皂片框的背景
        "#FF931E",
        "#8CD41E",
        "#854CAF",
        "#8C6239",
        "#1EBDB8",
        "#EBD700",
        "#29ABE2",
        "#ED1E79",
        "#009245"
    ],
    list:[],//图片列表
    init:function(){
        this.data=DATA;
        this.temp={
            small:[],
            big:[],
            tag:[]
        }
        if($(window).height()>=768){
            this.MAX_ROW=10;
            $('.top_pic_innerC').css('height','600px')
        }else if($(window).height()<768){
            this.MAX_ROW=10;
            $('.top_pic_innerC').css('height','500px')
        }
        this.renderAll();
    },
    renderAll:function(){
        this.renderRom();
        this.renderHtml();
        //this.pager();
    },
    renderRom:function(){
        var _this=this;
        _this.pushData(_this.data,_this.temp,'big');
        _this.pushData(_this.data,_this.temp,'small');
        _this.pushData(_this.data,_this.temp,'tag');
        for(var r=0;r<_this.MAX_ROW;r++){
            var row=[];
            for(var c=0;c<_this.MAX_COL;c++){
                row.push(0)
            }
            _this.grid.push(row)
        }
        _this.renderPosition(_this.temp.big,2,_this.ruleBig);
        _this.renderPosition(_this.temp.tag,1,_this.ruleTag,/*新加一个参数*/'width');
        _this.renderPosition(_this.temp.small,1);
    },
    //把dom元素挂进去
    pushData:function(data,temp,type){
        for(var i=0;i<data[type].length;i++){
            var d=data[type][i];
            if(d!=null){
                if(type!='tag'){
                    if(type=='big'){
                        var obj=$(`<div class="box_mar big_box" style="width: 300px;height: 300px;;background-color: #000;"><a href="${d.dy}"><img src="${d.durl}"></a></div>`);
                    }
                    if(type=='small'){
                        var obj=$(`<div class="box_mar little_box" style="width: 150px;height: 150px;;background-color: #ec4040;><a href="${d.dy}"><img src="${d.durl}"></a></div>`);
                    }
                }else if(type=='tag'){
                    var color=this.Rc();
                    var obj=$(`<div class="box_mar tag_tip" style="width: 300px;height: 150px;;background-color: #666;><p class="t2">${d.tag}</p><b class="tag_count">${d.ref}</b><div class="tag_ico"></div></div>`);
                    obj.css('background',color);
                    obj.css('width',this.BWIDTH*2 + "px");
                }
                temp[type].push(obj);
            }
        }
    },
    Rc:function(){//随机
        var r=Math.floor(Math.random()*156+100)
        var g=Math.floor(Math.random()*156+100)
        var b=Math.floor(Math.random()*156+100)
        return `rgb(${r},${g},${b})`;
    },
    renderPosition:function(list,size,rule,type){
        var _this=this;
        type = type || "";
        for(var i=0;i<list.length;i++){
            var gridC=[];
            var max_row = _this.MAX_ROW-size;
            for(var r=0;r<=max_row;r++){
                var startC=0,endC=_this.MAX_COL-size;
                if(rule){
                    startC=i*rule;
                    endC=(i+1)*rule-size;
                }
                for(var c=startC;c<=endC;c++){
                    if(type == "width"){
                        if (c+size+1>_this.MAX_COL)
                            continue;
                        if(!_this.check(_this.grid,r,c,size,'w')){
                            continue;
                        }
                    }else{
                        if(!_this.check(_this.grid,r,c,size)){
                            continue;
                        }
                    }

                    gridC.push({row:r,col:c})
                }
            }
            if(gridC.length==0){return}
            var posi=Math.floor(Math.random()*gridC.length)
            var pic=list[i];
            //宽格子
            if(type == "width"){
                _this.fillGrid(_this.grid,gridC[posi].row,gridC[posi].col,size,'w');
            }else{
                _this.fillGrid(_this.grid,gridC[posi].row,gridC[posi].col,size);
            }

            _this.list.push({
                obj:pic,
                col:gridC[posi].col,
                row:gridC[posi].row
            })
        }
    },
    //判断是否重复
    check:function(grid,row,col,size,ifWidth){
        var _this=this;
        ifWidth = ifWidth || "";
        var siz=size||1;
        if(size+col>_this.MAX_COL){return false}
        for(var x=0;x<siz;x++){
            if(ifWidth == "w"){
                for(var y=0;y<siz+1;y++){
                    if(grid[row+x][col+y]==1){return false}
                }
            }else{
                for(var y=0;y<siz;y++){
                    if(grid[row+x][col+y]==1){return false}
                }
            }

        }
        return true
    },
    fillGrid:function(list,row,col,size,ifWidth){
        var _this=this;
        var siz=size||1;
        ifWidth = ifWidth|| "";
        for(var x=0;x<siz;x++){
            if(ifWidth == "w"){
                for(var y=0;y<siz+1;y++){
                    _this.grid[row+x][col+y]=1;//等于1代表二维数组里的这块被占了
                }
            }else{
                for(var y=0;y<siz;y++){
                    _this.grid[row+x][col+y]=1;
                }
            }

        }
    },
    renderNormal:function(list,size){
        var _this=this;
        var i=0;
        for(var r=0;r<_this.MAX_ROW;r++){
            for(var c=0;c<=_this.MAX_COL;c++){
                if(_this.check(_this.grid,r,c,size)){
                    var pic=list[i];
                    _this.fillGrid(_this.grid,r,c,size);
                    _this.list.push({
                        obj:pic,
                        col:c,
                        row:r
                    })
                }
                i++;
                if(i>=list.length){break}
            }
            if(i>=list.length){break}
        }
    },
    //按内存里的数据渲染
    renderHtml:function(){
        var _this=this;
        //_this.warapper.width(_this.MAX_COL*(_this.Xgap+_this.BWIDTH)-_this.BWIDTH);
        console.log( _this.warapper.width());
        var picWrapper = $('<div class="pic-list clearfix"></div>').appendTo(_this.warapper).fadeIn();
        _this.list.sort(function(a,b){
            if(a.row>b.row){
                return 1;
            } else if(a.row<b.row){
                return -1;
            } else{
                return a.col - b.col;
            }
        });
        for(var i=0;i<_this.list.length;i++){
            var img=_this.list[i];
            var top=img.top=_this.Ygap*img.row+_this.BHEIGHT*img.row;
            var left=img.left=_this.Xgap*img.col+_this.BWIDTH*img.col;
            //console.log([top,left]);
            img.obj.appendTo(picWrapper).css({'top':top,'left':left});
            //img.obj.appendTo(picWrapper).css({'marginTop':10,'marginLeft':15});
        }
    }


}
picWall.init();